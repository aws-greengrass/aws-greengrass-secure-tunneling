---
RecipeFormatVersion: "2020-01-25"
ComponentName: "aws.greengrass.SecureTunnelingInC"
ComponentVersion: "1.0.0"
ComponentDescription:
  "AWS IoT Greengrass Secure Tunneling component implemented in C using gg-sdk."
ComponentPublisher: "Amazon"
ComponentConfiguration:
  DefaultConfiguration:
    maxConcurrentTunnels: 20
    tunnelTimeoutSeconds: 43200
    accessControl:
      aws.greengrass.ipc.mqttproxy:
        aws.greengrass.SecureTunnelingC:mqttproxy:1:
          policyDescription: "Access to tunnel notification pubsub topic"
          operations:
            - "aws.greengrass#SubscribeToIoTCore"
          resources:
            - "$aws/things/+/tunnels/notify"
Manifests:
  - Platform:
      os: "linux"
      runtime: "*"
    Lifecycle:
      run:
        "{artifacts:path}/secure-tunnel --thing-name {iot:thingName}
        --max-tunnels {configuration:/maxConcurrentTunnels} --timeout
        {configuration:/tunnelTimeoutSeconds} --artifact-path {artifacts:path}"
    Artifacts:
      - Uri: "s3://BUCKET_NAME/COMPONENT_NAME/COMPONENT_VERSION/secure-tunnel"
        Permission:
          Read: OWNER
          Execute: OWNER
      - Uri: "s3://BUCKET_NAME/COMPONENT_NAME/COMPONENT_VERSION/localproxy"
        Permission:
          Read: OWNER
          Execute: OWNER
